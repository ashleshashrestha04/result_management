{% extends 'base/base.html' %}

{% block title %}Performance Prediction - MyAcademia{% endblock %}

{% block extra_css %}
<style>
  .prediction-form {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 2rem;
    color: white;
    margin-bottom: 2rem;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #f8f9fa;
  }

  .form-control {
    width: 100%;
    padding: 0.75rem 1rem;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    background: rgba(255, 255, 255, 0.9);
  }

  .form-control:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
  }

  .btn-predict {
    background: linear-gradient(135deg, #ff6b6b, #ee5a24);
    color: white;
    border: none;
    padding: 1rem 2rem;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.3s ease;
  }

  .btn-predict:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
  }

  .prediction-result {
    background: white;
    border-radius: 15px;
    padding: 2rem;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    margin-top: 2rem;
  }

  .grade-display {
    text-align: center;
    padding: 2rem;
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    color: white;
    border-radius: 15px;
    margin-bottom: 2rem;
  }

  .grade-number {
    font-size: 4rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
  }

  .confidence-badge {
    background: rgba(255, 255, 255, 0.2);
    padding: 0.5rem 1rem;
    border-radius: 20px;
    display: inline-block;
    margin-top: 1rem;
  }

  .recommendations {
    margin-top: 2rem;
  }

  .recommendation-card {
    background: #f8f9fa;
    border-left: 4px solid #667eea;
    padding: 1.5rem;
    margin-bottom: 1rem;
    border-radius: 10px;
  }

  .recommendation-card.high-priority {
    border-left-color: #e74c3c;
    background: linear-gradient(135deg, #ffeaa7, #fab1a0);
  }

  .recommendation-card.medium-priority {
    border-left-color: #f39c12;
    background: linear-gradient(135deg, #a7f5f5, #74b9ff);
  }

  .rec-category {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.5rem;
  }

  .rec-impact {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.875rem;
    font-weight: 500;
    margin-top: 0.5rem;
  }

  .impact-high {
    background: #e74c3c;
    color: white;
  }

  .impact-medium {
    background: #f39c12;
    color: white;
  }

  .impact-low {
    background: #2ecc71;
    color: white;
  }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
  {% if messages %}
    <div class="mb-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}" role="alert">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
  <div class="row">
    <div class="col-12">
      <h2 class="mb-4">
        <i class="fas fa-brain me-2"></i>
        AI-Powered Performance Prediction
      </h2>
      <p class="lead mb-4">
        Enter your academic details below to get personalized grade predictions and improvement recommendations.
      </p>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-6">
      <div class="prediction-form">
        <h3 class="mb-3">
          <i class="fas fa-chart-line me-2"></i>
          Student Information
        </h3>
        
        <form method="post">
          {% csrf_token %}
          
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">Gender</label>
                <select name="gender" class="form-control" required>
                  <option value="">Select Gender</option>
                  <option value="Male" {% if student_data.gender == 'Male' %}selected{% endif %}>Male</option>
                  <option value="Female" {% if student_data.gender == 'Female' %}selected{% endif %}>Female</option>
                </select>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">Race/Ethnicity</label>
                <select name="race_ethnicity" class="form-control" required>
                  <option value="">Select Group</option>
                  <option value="group A" {% if student_data.race_ethnicity == 'group A' %}selected{% endif %}>Group A</option>
                  <option value="group B" {% if student_data.race_ethnicity == 'group B' %}selected{% endif %}>Group B</option>
                  <option value="group C" {% if student_data.race_ethnicity == 'group C' %}selected{% endif %}>Group C</option>
                  <option value="group D" {% if student_data.race_ethnicity == 'group D' %}selected{% endif %}>Group D</option>
                  <option value="group E" {% if student_data.race_ethnicity == 'group E' %}selected{% endif %}>Group E</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Parental Level of Education</label>
            <select name="parental_level_of_education" class="form-control" required>
              <option value="">Select Education Level</option>
              <option value="some high school" {% if student_data.parental_level_of_education == 'some high school' %}selected{% endif %}>Some High School</option>
              <option value="high school" {% if student_data.parental_level_of_education == 'high school' %}selected{% endif %}>High School</option>
              <option value="some college" {% if student_data.parental_level_of_education == 'some college' %}selected{% endif %}>Some College</option>
              <option value="associate's degree" {% if student_data.parental_level_of_education == "associate's degree" %}selected{% endif %}>Associate's Degree</option>
              <option value="bachelor's degree" {% if student_data.parental_level_of_education == "bachelor's degree" %}selected{% endif %}>Bachelor's Degree</option>
              <option value="master's degree" {% if student_data.parental_level_of_education == "master's degree" %}selected{% endif %}>Master's Degree</option>
            </select>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">Lunch Type</label>
                <select name="lunch" class="form-control" required>
                  <option value="">Select Lunch Type</option>
                  <option value="standard" {% if student_data.lunch == 'standard' %}selected{% endif %}>Standard</option>
                  <option value="free/reduced" {% if student_data.lunch == 'free/reduced' %}selected{% endif %}>Free/Reduced</option>
                </select>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">Test Preparation Course</label>
                <select name="test_preparation_course" class="form-control" required>
                  <option value="">Select Option</option>
                  <option value="none" {% if student_data.test_preparation_course == 'none' %}selected{% endif %}>None</option>
                  <option value="completed" {% if student_data.test_preparation_course == 'completed' %}selected{% endif %}>Completed</option>
                </select>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4">
              <div class="form-group">
                <label class="form-label">Study Hours per Week</label>
                <input type="number" name="study_hours_per_week" class="form-control" 
                       min="1" max="80" step="1" required
                       value="{{ student_data.study_hours_per_week|default:'' }}"
                       placeholder="e.g., 20">
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-group">
                <label class="form-label">Attendance Rate (%)</label>
                <input type="number" name="attendance_rate" class="form-control" 
                       min="0" max="100" step="0.1" required
                       value="{{ student_data.attendance_rate|default:'' }}"
                       placeholder="e.g., 85.5">
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-group">
                <label class="form-label">Previous Grade</label>
                <input type="number" name="previous_grade" class="form-control" 
                       min="0" max="100" step="0.1" required
                       value="{{ student_data.previous_grade|default:'' }}"
                       placeholder="e.g., 78.5">
              </div>
            </div>
          </div>

          <div class="text-center mt-4">
            <button type="submit" class="btn-predict">
              <i class="fas fa-magic me-2"></i>
              Predict My Performance
            </button>
          </div>
        </form>
      </div>
    </div>

    <div class="col-lg-6">
      {% if prediction_made %}
      <div class="prediction-result">
        <div class="grade-display">
          <div class="grade-number">{{ predicted_grade }}%</div>
          <div>Predicted Grade</div>
          <div class="confidence-badge">
            <i class="fas fa-check-circle me-1"></i>
            {{ confidence }}% Confidence
          </div>
        </div>

        {% if recommendations %}
        <div class="recommendations">
          <h4 class="mb-3">
            <i class="fas fa-lightbulb me-2"></i>
            Personalized Recommendations
          </h4>

          {% for rec in recommendations %}
          <div class="recommendation-card {% if rec.priority == 1 %}high-priority{% else %}medium-priority{% endif %}">
            <div class="rec-category">{{ rec.category }}</div>
            <div class="mb-2">{{ rec.suggestion }}</div>
            <span class="rec-impact impact-{{ rec.impact|lower }}">
              {{ rec.impact }} Impact
            </span>
          </div>
          {% endfor %}
        </div>
        {% endif %}
      </div>
      {% else %}
      <div class="prediction-result">
        <div class="text-center py-5">
          <i class="fas fa-chart-bar fa-5x text-muted mb-3"></i>
          <h4 class="text-muted">Ready to Predict!</h4>
          <p class="text-muted">Fill out the form on the left to get your personalized grade prediction and improvement recommendations.</p>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
